ä½œè€…ï¼šhicc, è…¾è®¯ CSIG å·¥ç¨‹å¸ˆ

æœ€çˆ±æŠ˜è…¾çš„å°±æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆäº†ï¼Œä»jQueryæŠ˜è…¾åˆ°AngularJsï¼Œå†æŠ˜è…¾åˆ°Vueã€Reactã€‚ æœ€çˆ±è·¨å±çš„ä¹Ÿæ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä»phonegapï¼ŒæŠ˜è…¾åˆ°React Nativeï¼Œè¿™ä¸åˆæŠ˜è…¾åˆ°äº†Flutterã€‚

å›¾å•¥ï¼Ÿ

**ä½æˆæœ¬**åœ°ä¸ºç”¨æˆ·å¸¦æ¥**æ›´ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ**ã€‚

ç›®å‰æ¥è¯´[Flutter](https://link.zhihu.com/?target=https%3A//flutter.dev/)å¯èƒ½æ˜¯å…¶ä¸­æœ€ä¼˜ç§€çš„ä¸€ç§æ–¹æ¡ˆäº†ã€‚

## **Flutteræ˜¯ä»€ä¹ˆï¼Ÿ**

> Flutter is Googleâ€™s UI toolkit for building beautiful, natively compiled applications forÂ [mobile](https://link.zhihu.com/?target=https%3A//flutter.dev/docs),Â [web](https://link.zhihu.com/?target=https%3A//flutter.dev/web), andÂ [desktop](https://link.zhihu.com/?target=https%3A//flutter.dev/desktop)Â from a single codebase.

[Flutter](https://link.zhihu.com/?target=https%3A//flutter.dev/)æ˜¯ç”±åŸGoogle Chromeå›¢é˜Ÿæˆå‘˜ï¼Œåˆ©ç”¨Chrome 2Dæ¸²æŸ“å¼•æ“ï¼Œç„¶åç²¾ç®€CSSå¸ƒå±€æ¼”å˜è€Œæ¥ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-53503fb404f135ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![](https://upload-images.jianshu.io/upload_images/19956127-783cefb5b479169b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
*   Flutteråœ¨å„ä¸ªåŸç”Ÿçš„å¹³å°ä¸­ï¼Œä½¿ç”¨è‡ªå·±çš„C++çš„å¼•æ“æ¸²æŸ“ç•Œé¢ï¼Œæ²¡æœ‰ä½¿ç”¨webviewï¼Œä¹Ÿä¸åƒRNã€NativeScriptä¸€æ ·ä½¿ç”¨ç³»ç»Ÿçš„ç»„ä»¶ã€‚ç®€å•æ¥è¯´å¹³å°åªæ˜¯ç»™Flutteræä¾›ä¸€ä¸ªç”»å¸ƒã€‚
*   ç•Œé¢ä½¿ç”¨Dartè¯­è¨€å¼€å‘ï¼Œè²Œä¼¼å”¯ä¸€æ”¯æŒJITï¼Œå’ŒAOTæ¨¡å¼çš„å¼ºç±»å‹è¯­è¨€ã€‚
*   å†™æ³•éå¸¸çš„ç°ä»£ï¼Œå£°æ˜å¼ï¼Œç»„ä»¶åŒ–ï¼ŒComposition > inheritanceï¼Œå“åº”å¼â€¦â€¦å°±æ˜¯ç°åœ¨å‰ç«¯æµè¡Œçš„è¿™ä¸€å¥—ğŸ˜„
*   ä¸€å¥—ä»£ç æå®šæ‰€æœ‰å¹³å°ã€‚

## **Flutter ä¸ºä»€ä¹ˆå¿«ï¼ŸFlutter ç›¸æ¯”RNçš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ**

ä»æ¶æ„ä¸­å®é™…ä¸Šå·²ç»èƒ½çœ‹å‡ºFlutterä¸ºä»€ä¹ˆå¿«ï¼Œè‡³å°‘ç›¸æ¯”ä¹‹å‰çš„å½“çº¢ç‚¸å­é¸¡React Nativeå¿«çš„åŸå› äº†ã€‚

*   Skia å¼•æ“ï¼ŒChromeï¼Œ Chrome OSï¼ŒAndroidï¼ŒFirefoxï¼ŒFirefox OSéƒ½ä»¥æ­¤ä½œä¸ºæ¸²æŸ“å¼•æ“ã€‚
*   Dartè¯­è¨€å¯ä»¥AOTç¼–è¯‘æˆARM Codeï¼Œè®©å¸ƒå±€ä»¥åŠä¸šåŠ¡ä»£ç è¿è¡Œçš„æœ€å¿«ï¼Œè€Œä¸”Dartçš„GCé’ˆå¯¹Flutteré¢‘ç¹é”€æ¯åˆ›å»ºWidgetåšäº†ä¸“é—¨çš„ä¼˜åŒ–ã€‚
*   CSSçš„çš„å­é›†Flex likeçš„å¸ƒå±€æ–¹å¼ï¼Œä¿ç•™å¼ºå¤§è¡¨ç°èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿä¿ç•™äº†æ€§èƒ½ã€‚
*   Flutterä¸šåŠ¡ä¹¦å†™çš„Widgetåœ¨æ¸²æŸ“ä¹‹å‰diffè½¬åŒ–æˆRender Objectï¼Œå¯¹ï¼Œå°±åƒReactä¸­çš„Virtual DOMï¼Œä»¥æ­¤æ¥ç¡®ä¿å¼€å‘ä½“éªŒå’Œæ€§èƒ½ã€‚

è€Œç›¸æ¯”React Nativeï¼š

*   RN ä½¿ç”¨JavaScriptæ¥è¿è¡Œä¸šåŠ¡ä»£ç ï¼Œç„¶åJS Bridgeçš„æ–¹å¼è°ƒç”¨å¹³å°ç›¸å…³ç»„ä»¶ï¼Œæ€§èƒ½æ¯”æœ‰æŸå¤±ï¼Œç”šè‡³å¹³å°ä¸åŒjså¼•æ“éƒ½ä¸ä¸€æ ·ã€‚
*   RN ä½¿ç”¨å¹³å°ç»„ä»¶ï¼Œè¡Œä¸ºä¸€è‡´æ€§ä¼šæœ‰æ‰“æŠ˜ï¼Œæˆ–è€…è¯´ï¼Œå¼€å‘è€…éœ€è¦å¤„ç†æ›´å¤šå¹³å°ç›¸å…³çš„é—®é¢˜ã€‚

è€Œå…·ä½“ä¸¤è€…çš„æ€§èƒ½æµ‹è¯•ï¼Œå¯ä»¥çœ‹[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//www.yuque.com/xytech/flutter/gs3pnk)ï¼Œç»“è®ºæ˜¯Flutterï¼Œåœ¨CPUï¼ŒFPSï¼Œå†…å­˜ç¨³å®šä¸Šå‡ä¼˜äºReactNativeã€‚

## **Dart è¯­è¨€**

åœ¨å¼€å§‹Flutterä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸‹Dartè¯­è¨€â€¦â€¦

Dartæ˜¯ç”±Googleå¼€å‘ï¼Œæœ€åˆæ˜¯æƒ³ä½œä¸ºJavaScriptæ›¿ä»£è¯­è¨€ï¼Œä½†æ˜¯å¤±è´¥æ²‰å¯‚ä¹‹åï¼Œä½œä¸ºFlutterç‹¬æœ‰å¼€å‘è¯­è¨€åˆç„•å‘äº†ç¬¬äºŒæ˜¥ğŸ˜‚ã€‚

å®é™…ä¸Šå³ä½¿åˆ°äº†2.0ï¼Œ[Dartè¯­æ³•](https://link.zhihu.com/?target=https%3A//dart.dev/guides/language/language-tour)å’ŒJavaScript[Flutter](https://link.zhihu.com/?target=https%3A//flutter.dev/)éå¸¸çš„ç›¸åƒã€‚å•çº¿ç¨‹ï¼ŒEvent Loopâ€¦â€¦
![](https://upload-images.jianshu.io/upload_images/19956127-209cbff52419543f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å½“ç„¶ä½œä¸ºä¸€ç¯‡å†™ç»™å‰ç«¯å·¥ç¨‹å¸ˆçš„æ•™ç¨‹ï¼Œæˆ‘åœ¨è¿™é‡Œåªæƒ³å†™å†™JavaScriptä¸­æš‚æ—¶æ²¡æœ‰çš„ï¼ŒDartä¸­æ›´ä¸ºçœå¿ƒï¼Œä¹Ÿæ›´â€œç”œâ€çš„ä¸œè¥¿ã€‚

*   ä¸ä¼šé£˜çš„`this`
*   å¼ºç±»å‹ï¼Œå½“ç„¶å‰ç«¯ç°åœ¨æœ‰äº†TypeScript ğŸ˜¬
*   å¼ºå¤§æ–¹ä¾¿çš„æ“ä½œç¬¦å·ï¼š
*   `?.`Â æ–¹ä¾¿å®‰å…¨çš„`foo?.bar`å–å€¼ï¼Œå¦‚æœfooä¸º`null`ï¼Œé‚£ä¹ˆå–å€¼ä¸º`null`
*   `??``condition ? expr1 : expr2`Â å¯ä»¥ç®€å†™ä¸º`expr1 ?? expr2`
*   `=`å’Œå…¶ä»–ç¬¦å·çš„ç»„åˆ:Â `*=`ã€`~/=`ã€`&=`ã€`|=`Â â€¦â€¦
*   çº§è”æ“ä½œç¬¦(Cascade notation ..)

```
// æƒ³æƒ³è¿™æ ·çœäº†å¤šå°‘å˜é‡å£°æ˜
querySelect('#button')
 ..text ="Confirm"
 ..classes.add('important')
 ..onClick.listen((e) => window.alert('Confirmed'))

```

ç”šè‡³å¯ä»¥é‡å†™æ“ä½œç¬¦

```
class Vector {
  final int x, y;

  Vector(this.x, this.y);

  Vector operator +(Vector v) => Vector(x + v.x, y + v.y);
  Vector operator -(Vector v) => Vector(x - v.x, y - v.y);

  // Operator == and hashCode not shown. For details, see note below.
  // Â·Â·Â·
}

void main() {
  final v = Vector(2, 3);
  final w = Vector(2, 2);

  assert(v + w == Vector(4, 5));
  assert(v - w == Vector(0, 1));
}

```

æ³¨ï¼š*é‡å†™`==`ï¼Œä¹Ÿéœ€è¦é‡å†™ObjectÂ `hashCode`getter*

```
class Person {
  final String firstName, lastName;

  Person(this.firstName, this.lastName);

  // Override hashCode using strategy from Effective Java,
  // Chapter 11.
  @override
  int get hashCode {
    int result = 17;
    result = 37 * result + firstName.hashCode;
    result = 37 * result + lastName.hashCode;
    return result;
  }

  // You should generally implement operator == if you
  // override hashCode.
  @override
  bool operator ==(dynamic other) {
    if (other is! Person) return false;
    Person person = other;
    return (person.firstName == firstName &&
        person.lastName == lastName);
  }
}

void main() {
  var p1 = Person('Bob', 'Smith');
  var p2 = Person('Bob', 'Smith');
  var p3 = 'not a person';
  assert(p1.hashCode == p2.hashCode);
  assert(p1 == p2);
  assert(p1 != p3);
}

```

è¿™ç‚¹åœ¨diffå¯¹è±¡çš„æ—¶å€™å°¤å…¶æœ‰ç”¨ã€‚

### **lsolate**

Dartè¿è¡Œåœ¨ç‹¬ç«‹éš”ç¦»çš„iSolateä¸­å°±ç±»ä¼¼JavaScriptä¸€æ ·ï¼Œå•çº¿ç¨‹äº‹ä»¶é©±åŠ¨ï¼Œä½†æ˜¯Dartä¹Ÿå¼€æ”¾äº†åˆ›å»ºå…¶ä»–isolateï¼Œå……åˆ†åˆ©ç”¨CPUçš„å¤šå’Œèƒ½åŠ›ã€‚

```
loadData() async {
   // é€šè¿‡spawnæ–°å»ºä¸€ä¸ªisolateï¼Œå¹¶ç»‘å®šé™æ€æ–¹æ³•
   ReceivePort receivePort =ReceivePort();
   await Isolate.spawn(dataLoader, receivePort.sendPort);

   // è·å–æ–°isolateçš„ç›‘å¬port
   SendPort sendPort = await receivePort.first;
   // è°ƒç”¨sendReceiveè‡ªå®šä¹‰æ–¹æ³•
   List dataList = await sendReceive(sendPort, 'https://hicc.me/posts');
   print('dataList $dataList');
}

// isolateçš„ç»‘å®šæ–¹æ³•
static dataLoader(SendPort sendPort) async{
   // åˆ›å»ºç›‘å¬portï¼Œå¹¶å°†sendPortä¼ ç»™å¤–ç•Œç”¨æ¥è°ƒç”¨
   ReceivePort receivePort =ReceivePort();
   sendPort.send(receivePort.sendPort);

   // ç›‘å¬å¤–ç•Œè°ƒç”¨
   await for (var msg in receivePort) {
     String requestURL =msg[0];
     SendPort callbackPort =msg[1];

     Client client = Client();
     Response response = await client.get(requestURL);
     List dataList = json.decode(response.body);
     // å›è°ƒè¿”å›å€¼ç»™è°ƒç”¨è€…
     callbackPort.send(dataList);
  }    
}

// åˆ›å»ºè‡ªå·±çš„ç›‘å¬portï¼Œå¹¶ä¸”å‘æ–°isolateå‘é€æ¶ˆæ¯
Future sendReceive(SendPort sendPort, String url) {
   ReceivePort receivePort =ReceivePort();
   sendPort.send([url, receivePort.sendPort]);
   // æ¥æ”¶åˆ°è¿”å›å€¼ï¼Œè¿”å›ç»™è°ƒç”¨è€…
   return receivePort.first;
}

```

å½“ç„¶Flutterä¸­å°è£…äº†[compute](https://link.zhihu.com/?target=https%3A//api.flutter.dev/flutter/foundation/compute.html)ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨ï¼Œè­¬å¦‚[åœ¨å…¶å®ƒisolateä¸­è§£æå¤§çš„json](https://link.zhihu.com/?target=https%3A//flutter.dev/docs/cookbook/networking/background-parsing)ã€‚

### **Dart UI as Code**

åœ¨è¿™é‡Œå•ç‹¬æå‡ºæ¥çš„æ„ä¹‰åœ¨äºï¼Œä»Reactå¼€å§‹ï¼Œåˆ°Flutterï¼Œåˆ°æœ€è¿‘çš„Apple SwiftUIï¼ŒAndroid Jetpack Compose å£°æ˜å¼ç»„ä»¶å†™æ³•è¶Šå‘æµè¡Œï¼ŒWeb å‰ç«¯ä½¿ç”¨JSXæ¥è®©å¼€å‘è€…æ›´æ–¹ä¾¿çš„ä¹¦å†™ï¼Œè€ŒFlutterï¼ŒSwiftUIåˆ™ç›´æ¥ä»ä¼˜åŒ–è¯­è¨€æœ¬èº«ç€æ‰‹ã€‚

### **å‡½æ•°ç±»çš„å‘½åå‚æ•°**

```
void test({@required int age,String name}) {
  print(name);
  print(age);
}
// è§£å†³å‡½æ•°è°ƒç”¨æ—¶å€™ï¼Œå‚æ•°ä¸æ˜ç¡®çš„é—®é¢˜
test(name:"hicc",age: 30)

// è¿™æ ·å¯¹äºç»„ä»¶çš„ä½¿ç”¨å°¤ä¸ºæ–¹ä¾¿
class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
  return Scaffold(
      appBar: AppBar(),
      body: Container(),
      floatingActionButton:FloatingActionButton()
    );
  }
}

```

### **å¤§æ€å™¨ï¼šCollection If å’Œ Collection For**

```
// collection If
Widget build(BuildContext context) {
  return Row(
    children: [
      IconButton(icon: Icon(Icons.menu)),
      Expanded(child: title),
      if (!isAndroid)
        IconButton(icon: Icon(Icons.search)),
    ],
  );
}

// Collect For
var command = [
  engineDartPath,
  frontendServer,
  for (var root in fileSystemRoots) "--filesystem-root=$root",
  for (var entryPoint in entryPoints)
    if (fileExists("lib/$entryPoint.json")) "lib/$entryPoint",
  mainPath
];

```

æ›´å¤šDart 2.3å¯¹æ­¤çš„ä¼˜åŒ–çœ‹[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//medium.com/dartlang/making-dart-a-better-language-for-ui-f1ccaf9f546c)ã€‚

## **Flutter æ€ä¹ˆå†™**

åˆ°è¿™é‡Œç»ˆäºåˆ°æ­£é¢˜äº†ï¼Œå¦‚æœç†Ÿæ‚‰webå‰ç«¯ï¼Œç†Ÿæ‚‰Reactçš„è¯ï¼Œä½ ä¼šå¯¹ä¸‹é¢è¦è®²çš„å¼‚å¸¸çš„ç†Ÿæ‚‰ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-0be008226088680f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
Flutter Appçš„ä¸€åˆ‡ä»`lib/main.dart`æ–‡ä»¶çš„mainå‡½æ•°å¼€å§‹ï¼š

```
import 'package:flutter/material.dart';

void main() => runApp(MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Welcome to Flutter',
      home: Scaffold(
        appBar: AppBar(
          title: Text('Welcome to Flutter'),
        ),
        body: Center(
          child: Text('Hello World'),
        ),
      ),
    );
  }
}

```

Dart ç±»buildæ–¹æ³•è¿”å›çš„ä¾¿æ˜¯Widgetï¼Œåœ¨Flutterä¸­ä¸€åˆ‡éƒ½æ˜¯Widgetï¼ŒåŒ…æ‹¬ä½†ä¸é™äº

*   ç»“æ„æ€§å…ƒç´ ï¼Œmenuï¼Œbuttonç­‰
*   æ ·å¼ç±»å…ƒç´ ï¼Œfontï¼Œcolorç­‰
*   å¸ƒå±€ç±»å…ƒç´ ï¼Œpaddingï¼Œmarginç­‰
*   å¯¼èˆª
*   æ‰‹åŠ¿

Widgetæ˜¯Dartä¸­ç‰¹æ®Šçš„ç±»ï¼Œé€šè¿‡å®ä¾‹åŒ–(Dart ä¸­[newæ˜¯å¯é€‰çš„](https://link.zhihu.com/?target=https%3A//dart.dev/guides/language/language-tour%23using-constructors))ç›¸äº’åµŒå¥—ï¼Œä½ çš„è¿™ä¸ªAppå°±æ˜¯å½¢å¦‚ä¸‹å›¾çš„ä¸€é¢—ç»„ä»¶æ ‘(Dartå…¥å£å‡½æ•°çš„æ¦‚å¿µï¼Œ`main.dart -> main()`)ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-edb841cf236c1aa7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
### **Widgetå¸ƒå±€**

ä¸Šè¯´è¿‡Flutterå¸ƒå±€æ€è·¯æ¥è‡ªCSSï¼Œè€ŒFlutterä¸­ä¸€åˆ‡çš†Widgetï¼Œå› æ­¤æ•´ä½“å¸ƒå±€ä¹Ÿå¾ˆç®€å•ï¼š

*   å®¹å™¨ç»„ä»¶Container
*   decorationè£…é¥°å±æ€§ï¼Œè®¾ç½®èƒŒæ™¯è‰²ï¼ŒèƒŒæ™¯å›¾ï¼Œè¾¹æ¡†ï¼Œåœ†è§’ï¼Œé˜´å½±å’Œæ¸å˜ç­‰
*   margin
*   padding
*   alignment
*   width
*   height
*   Paddingï¼ŒCenter
*   Row,Column,Flex
*   Wrap, Flowæµå¼å¸ƒå±€
*   Stackï¼Œ Zè½´å¸ƒå±€
*   â€¦â€¦

[æ›´å¤šå¯ä»¥çœ‹è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//www.yuque.com/xytech/flutter/hc0xq7)

Flutterä¸­Widgetå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œå½¢å¦‚Reactä¸­â€œå±•ç¤ºç»„ä»¶â€ã€â€œå®¹å™¨ç»„ä»¶â€ï¼Œâ€œcontextâ€ã€‚

### **StatelessWidget**

è¿™ä¸ªå°±æ˜¯Flutterä¸­çš„â€œå±•ç¤ºç»„ä»¶â€ï¼Œè‡ªèº«ä¸ä¿å­˜çŠ¶æ€ï¼Œå¤–éƒ¨å‚æ•°å˜åŒ–å°±é”€æ¯é‡æ–°åˆ›å»ºã€‚Flutterå»ºè®®å°½é‡ä½¿ç”¨æ— çŠ¶æ€çš„ç»„ä»¶ã€‚

### **StatefulWidget**

çŠ¶æ€ç»„ä»¶å°±æ˜¯ç±»ä¼¼äºReactä¸­çš„â€œå®¹å™¨ç»„ä»¶â€äº†ï¼ŒFlutterä¸­çŠ¶æ€ç»„ä»¶å†™æ³•ä¼šç¨å¾®ä¸ä¸€æ ·ã€‚

```
class Counter extends StatefulWidget {
  // This class is the configuration for the state. It holds the
  // values (in this case nothing) provided by the parent and used by the build
  // method of the State. Fields in a Widget subclass are always marked "final".

  @override
  _CounterState createState() => _CounterState();
}

class _CounterState extends State<Counter> {
  int _counter = 0;

  void _increment() {
    setState(() {
      // This call to setState tells the Flutter framework that
      // something has changed in this State, which causes it to rerun
      // the build method below so that the display can reflect the
      // updated values. If you change _counter without calling
      // setState(), then the build method won't be called again,
      // and so nothing would appear to happen.
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    // This method is rerun every time setState is called, for instance
    // as done by the _increment method above.
    // The Flutter framework has been optimized to make rerunning
    // build methods fast, so that you can just rebuild anything that
    // needs updating rather than having to individually change
    // instances of widgets.
    return Row(
      children: <Widget>[
        RaisedButton(
          onPressed: _increment,
          child: Text('Increment'),
        ),
        Text('Count: $_counter'),
      ],
    );
  }
}

```

å¯ä»¥çœ‹åˆ°Flutterä¸­ç›´æ¥ä½¿ç”¨äº†å’ŒReactä¸­åŒåçš„`setState`æ–¹æ³•ï¼Œä¸è¿‡ä¸ä¼šæœ‰å˜é‡åˆå¹¶çš„ä¸œè¥¿ï¼Œå½“ç„¶ä¹Ÿæœ‰[ç”Ÿå‘½å‘¨æœŸ](https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000015211309)ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-ba41038574178586.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶éœ€è¦ä¸¤ä¸ªClassï¼Œè¿™æ ·å†™çš„åŸå› åœ¨äºï¼ŒFlutterä¸­Widgetéƒ½æ˜¯immmutableçš„ï¼ŒçŠ¶æ€ç»„ä»¶çš„çŠ¶æ€ä¿å­˜åœ¨Stateä¸­ï¼Œç»„ä»¶ä»ç„¶æ¯æ¬¡é‡æ–°åˆ›å»ºï¼ŒWidgetåœ¨è¿™é‡Œåªæ˜¯ä¸€ç§å¯¹ç»„ä»¶çš„æè¿°ï¼ŒFlutterä¼šdiffè½¬æ¢æˆElementï¼Œç„¶åè½¬æ¢æˆRenderObjectæ‰æ¸²æŸ“ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-f8022b0bb6259992.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
Flutter Widgetæ›´å¤šçš„æ¸²æŸ“æµç¨‹å¯ä»¥çœ‹[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//www.yuque.com/xytech/flutter/tge705)ã€‚

å®é™…ä¸ŠWidgetåªæ˜¯ä½œä¸ºç»„ä»¶ç»“æ„ä¸€ç§æè¿°ï¼Œè¿˜å¯ä»¥å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥æ›´æ–¹ä¾¿çš„åšä¸€äº›[ä¸»é¢˜æ€§çš„ç»„ä»¶](https://link.zhihu.com/?target=https%3A//flutter.dev/docs/development/ui/widgets), Flutterå®˜æ–¹æä¾›çš„[Material Components widgets](https://link.zhihu.com/?target=https%3A//flutter.dev/docs/development/ui/widgets/material)å’Œ[Cupertino (iOS-style) widgets](https://link.zhihu.com/?target=https%3A//flutter.dev/docs/development/ui/widgets/cupertino)è´¨é‡å°±ç›¸å½“é«˜ï¼Œå†é…åˆFlutteräºšç§’çº§çš„[Hot Reload](https://link.zhihu.com/?target=https%3A//flutter.dev/docs/development/tools/hot-reload)ï¼Œå¼€å‘ä½“éªŒå¯ä»¥è¯´æŒºä¸é”™çš„ã€‚

* * *

## **State Management**

`setState()`å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†ç»„ä»¶å†…çš„æ•°æ®ï¼Œä½†æ˜¯Flutterä¸­çŠ¶æ€åŒæ ·æ˜¯ä»ä¸Šå¾€ä¸‹æµè½¬çš„ï¼Œå› æ­¤ä¹Ÿä¼šé‡åˆ°å’ŒReactä¸­åŒæ ·çš„é—®é¢˜ï¼Œå¦‚æœç»„ä»¶æ ‘å¤ªæ·±ï¼Œé€å±‚çŠ¶æ€åˆ›å»ºå°±æ˜¾å¾—å¾ˆéº»çƒ¦äº†ï¼Œæ›´ä¸è¦è¯´ä»£ç çš„æ˜“è¯»å’Œæ˜“ç»´æŠ¤æ€§äº†ã€‚

### **InheritedWidget**

åŒæ ·Flutterä¹Ÿæœ‰ä¸ª`context`ä¸€æ ·çš„ä¸œè¥¿ï¼Œé‚£å°±æ˜¯`InheritedWidget`ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ã€‚

```
class GlobalData extends InheritedWidget {
  final int count;
  GlobalData({Key key, this.count,Widget child}):super(key:key,child:child);

  @override
  bool updateShouldNotify(GlobalData oldWidget) {
    return oldWidget.count != count;
  }

  static GlobalData of(BuildContext context) => context.inheritFromWidgetOfExactType(GlobalData);
}

class MyApp extends StatelessWidget {
  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: MyHomePage(title: 'Flutter Demo Home Page'),
    );
  }
}

class MyHomePage extends StatefulWidget {
  MyHomePage({Key key, this.title}) : super(key: key);

  final String title;

  @override
  _MyHomePageState createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  int _counter = 0;

  void _incrementCounter() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: GlobalData(
        count: _counter,
        child: Center(          
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: <Widget>[
              Text(
                'You have pushed the button this many times:',
              ),
              Text(
                '$_counter',
                style: Theme.of(context).textTheme.display1,
              ),
              Body(),
              Body2()
            ],
          ),
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: Icon(Icons.add),
      ),
    );
  }
}

class Body extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    GlobalData globalData = GlobalData.of(context);
    return Text(globalData.count.toString());
  }
}

class Body2 extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // TODO: implement build
    GlobalData globalData = GlobalData.of(context);
    return Text(globalData.count.toString());
  }

```

å…·ä½“å®ç°åŸç†å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//loveky.github.io/2018/07/18/how-flutter-inheritedwidget-works/)ï¼Œä¸è¿‡Googleå°è£…äº†ä¸€ä¸ªæ›´ä¸ºä¸Šå±‚çš„åº“[provider](https://link.zhihu.com/?target=https%3A//pub.dev/packages/provider)ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥çœ‹[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//flutter.dev/docs/development/data-and-backend/state-mgmt/simple)ã€‚

### **BlOC**

[BlOC](https://link.zhihu.com/?target=https%3A//medium.com/flutterpub/architecting-your-flutter-project-bd04e144a8f1)æ˜¯Flutter teamæå‡ºå»ºè®®çš„å¦ä¸€ç§æ›´é«˜çº§çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼Œä¹Ÿæ˜¯æˆ‘æœ€ä¸­æ„çš„æ–¹å¼ã€‚ç®€å•æ¥è¯´ï¼š

**Bloc = InheritedWidget + RxDart(Stream)**

Dartè¯­è¨€ä¸­å†…ç½®äº†Steamï¼ŒStream ~= Observableï¼Œé…åˆ[RxDart](https://link.zhihu.com/?target=https%3A//pub.dev/packages/rxdart), ç„¶ååŠ ä¸Š`StreamBuilder`ä¼šæ˜¯ä¸€ç§å¼‚å¸¸å¼ºå¤§å’Œè‡ªç”±çš„æ¨¡å¼ã€‚

```
class GlobalData extends InheritedWidget {
  final int count;
  final Stream<String> timeInterval$ = new Stream.periodic(Duration(seconds: 10)).map((time) => new DateTime.now().toString());
  GlobalData({Key key, this.count,Widget child}):super(key:key,child:child);

  @override
  bool updateShouldNotify(GlobalData oldWidget) {
    return oldWidget.count != count;
  }

  static GlobalData of(BuildContext context) => context.inheritFromWidgetOfExactType(GlobalData);

}

class TimerView extends StatelessWidget {

  @override
  Widget build(BuildContext context) {
    GlobalData globalData = GlobalData.of(context);
    return StreamBuilder(
        stream: globalData.timeInterval$,
        builder: (context, snapshot) {
          return Text(snapshot?.data ?? '');
        }
    );
  }
}

```

å½“ç„¶Blocçš„é—®é¢˜åœ¨äº

*   å­¦ä¹ æˆæœ¬ç•¥é«˜ï¼ŒRxçš„æ¦‚å¿µè¦åƒé€ï¼Œä¸ç„¶ä½ ä¼šæŠ“ç‹‚
*   è‡ªç”±å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œå¯èƒ½ä»£ç ä¸å¦‚Reduxç±»çš„è§„æ•´ã€‚

é¡ºä¾¿ï¼Œä»Šå¹´Appleä¹Ÿæ‹¥æŠ±äº†å“åº”å¼ï¼Œ[Combine](https://link.zhihu.com/?target=https%3A//developer.apple.com/documentation/combine)(Rx like) + SwiftUI ä¹ŸåŸºæœ¬ç­‰äºBlocäº†ã€‚

æ‰€ä»¥ï¼ŒRxè¿˜æ˜¯è¦èµ¶ç´§å­¦èµ·æ¥ğŸ˜¬

é™¤å»Blocï¼ŒFlutterä¸­è¿˜æ˜¯å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ¡ˆï¼Œè­¬å¦‚ï¼š

*   [Flutter Redux](https://link.zhihu.com/?target=https%3A//pub.dev/packages/flutter_redux)
*   é˜¿é‡Œé—²é±¼çš„[Fish Redux](https://link.zhihu.com/?target=https%3A//github.com/alibaba/fish-redux)ï¼Œ*æ®è¯´æ€§èƒ½å¾ˆå¥½*ã€‚
*   [Mobx](https://link.zhihu.com/?target=https%3A//mobx.pub/)
*   â€¦â€¦

å±•å¼€æ¥è¯´ç°åœ¨çš„å‰ç«¯å¼€å‘ä½¿ç”¨å¼ºå¤§çš„æ¡†æ¶é¡µé¢ç»„è£…å·²ç»ä¸æ˜¯éš¾ç‚¹äº†ã€‚å¼€å‘çš„éš¾ç‚¹åœ¨äºå¦‚ä½•ç»„åˆå¯Œäº¤äº’æ‰€éœ€çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å›¾ä¸­çš„`state`éƒ¨åˆ†ã€‚

æ›´å…·ä½“æ¥è¯´ï¼Œæ˜¯æ€ä¹ˆä¼˜é›…ï¼Œé«˜æ•ˆï¼Œæ˜“ç»´æŠ¤åœ°å¤„ç†çŸ­æš‚æ•°æ®(ephemeral state)`setState()`å’Œéœ€è¦å…±äº«çš„App Stateçš„é—®é¢˜ï¼Œè¿™æ˜¯ä¸ªå·¥ç¨‹æ€§çš„é—®é¢˜ï¼Œä½†å¾€å¾€ä¹Ÿæ˜¯æ—¥å¸¸å¼€å‘æœ€éš¾çš„äº‹æƒ…äº†ï¼Œå¼•ç”¨Reduxä½œè€…Dançš„ä¸€å¥ï¼š

> â€œThe rule of thumb is:[Do whatever is less awkward](https://link.zhihu.com/?target=https%3A//github.com/reduxjs/redux/issues/1287%23issuecomment-175351978).â€

åˆ°è¿™é‡Œï¼Œä¸»è¦çš„éƒ¨åˆ†å·²ç»è®²å®Œäº†ï¼Œæœ‰è¿™äº›å·²ç»å¯ä»¥å¼€å‘å‡ºä¸€ä¸ªä¸é”™çš„Appäº†ã€‚å‰©ä¸‹çš„å°±å½“æˆä¸€ä¸ªbonuså§ã€‚

* * *

## **æµ‹è¯•**

Flutter debuggerï¼Œæµ‹è¯•éƒ½æ˜¯å‡ºåœºè‡ªå¸¦ï¼Œç”¨èµ·æ¥ä¹Ÿä¸éš¾ã€‚

```
// æµ‹è¯•åœ¨/test/ç›®å½•ä¸‹é¢
void main() {

  testWidgets('Counter increments smoke test', (WidgetTester tester) async {
    // Build our app and trigger a frame.
    await tester.pumpWidget(MyApp());

    // Verify that our counter starts at 0.
    expect(find.text('0'), findsOneWidget);
    expect(find.text('1'), findsNothing);

    // Tap the '+' icon and trigger a frame.
    await tester.tap(find.byIcon(Icons.add));
    await tester.pump();

    // Verify that our counter has incremented.
    expect(find.text('0'), findsNothing);
    expect(find.text('1'), findsOneWidget);
  });
}

```

## **åŒ…ç®¡ç†ï¼Œèµ„æºç®¡ç†**

ç±»ä¼¼ä¸JavaScriptçš„npmï¼ŒFlutterï¼Œä¹Ÿå°±æ˜¯Dartä¹Ÿæœ‰è‡ªå·±çš„[åŒ…ä»“åº“](https://link.zhihu.com/?target=https%3A//pub.dev/)ã€‚ä¸è¿‡é¡¹ç›®åŒ…çš„ä¾èµ–ä½¿ç”¨yamlæ–‡ä»¶æ¥æè¿°:

```
name: app
description: A new Flutter project.
version: 1.0.0+1

environment:
  sdk: ">=2.1.0 <3.0.0"

dependencies:
  flutter:
    sdk: flutter

  cupertino_icons: ^0.1.2

```

## **ç”Ÿå‘½å‘¨æœŸ**

ç§»åŠ¨åº”ç”¨æ€»å½’éœ€è¦åº”ç”¨çº§åˆ«çš„ç”Ÿå‘½å‘¨æœŸï¼Œflutterä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¹Ÿéå¸¸çš„ç®€å•ï¼š

```
class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() => new _MyAppState();
}

class _MyAppState extends State<MyApp> with WidgetsBindingObserver {
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addObserver(this);
  }

  @override
  void dispose() {
    WidgetsBinding.instance.removeObserver(this);
    super.dispose();
  }

  @override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    switch (state) {
      case AppLifecycleState.inactive:
        print('AppLifecycleState.inactive');
        break;
      case AppLifecycleState.paused:
        print('AppLifecycleState.paused');
        break;
      case AppLifecycleState.resumed:
        print('AppLifecycleState.resumed');
        break;
      case AppLifecycleState.suspending:
        print('AppLifecycleState.suspending');
        break;
    }
    super.didChangeAppLifecycleState(state);
  }

  @override
  Widget build(BuildContext context) {
      return Container();
  }
}

```

## **ä½¿ç”¨åŸç”Ÿèƒ½åŠ›**

å’ŒReactNativeç±»ä¼¼ï¼ŒFlutterä¹Ÿæ˜¯ä½¿ç”¨ç±»ä¼¼äº‹ä»¶çš„æœºåˆ¶æ¥ä½¿ç”¨å¹³å°ç›¸å…³èƒ½åŠ›ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-9fab2f7c6d5445b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
Flutter Web, Flutter Desktop
è¿™äº›è¿˜åœ¨å¼€å‘å½“ä¸­ï¼Œé‰´äºå¯¹Dartå–œæ¬¢ï¼Œä»¥åŠå¯¹Flutteræ€§èƒ½çš„ä¹è§‚ï¼Œè¿™äº›å€’æ˜¯å¾ˆå€¼å¾—æœŸå¾…ã€‚
![](https://upload-images.jianshu.io/upload_images/19956127-783e3b18ce1553e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
è¿˜è®°å¾—å¹³å°åªæ˜¯ç»™Flutteræä¾›ä¸€ä¸ªç”»å¸ƒä¹ˆï¼ŒFlutter Desktopæœªæ¥æ›´æ˜¯å¯ä»¥å¤§æœ‰å¯ä¸ºğŸ˜„ï¼Œç›¸å…³å¯ä»¥çœ‹[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//github.com/flutter/flutter/wiki/Desktop-shells)ã€‚

æœ€åæ¯ç§æ–¹æ¡ˆï¼Œæ¯ç§æŠ€æœ¯éƒ½æœ‰[ä¼˜ç¼ºç‚¹](https://link.zhihu.com/?target=https%3A//medium.com/asos-techblog/flutter-vs-react-native-for-ios-android-app-development-c41b4e038db9)ï¼Œç”šè‡³æŠ€æœ¯çš„æ¶æ„å†³å®šäº†ï¼Œæœ‰äº›ç¼ºé™·å¯èƒ½æ°¸è¿œéƒ½æ²¡æ³•æ”¹è¿›ï¼Œæ‰€ä»¥ğŸ¤”
åŸæ–‡ä½œè€…ï¼šè…¾è®¯æŠ€æœ¯
åŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/97653115
æ¥æºï¼šçŸ¥ä¹
**æ¨èé˜…è¯»ï¼š[æœ€å¼ºæ•´ç†ï¼šä¸€çº¿äº’è”ç½‘ç§»åŠ¨æ¶æ„å¸ˆç­‘åŸºå¿…å¤‡æŠ€èƒ½ä¹‹Javaç¯‡](https://www.jianshu.com/p/1be7ec369819)**
**[æœ€å¼ºæ•´ç†ï¼šä¸€çº¿äº’è”ç½‘ç§»åŠ¨æ¶æ„å¸ˆAndroidæ¡†æ¶ä½“ç³»æ¶æ„](https://www.jianshu.com/p/077ddec7ced6)**
**[æœ€å¼ºæ•´ç†ï¼šä¸€çº¿äº’è”ç½‘ç§»åŠ¨æ¶æ„å¸ˆ360Â°å…¨æ–¹é¢æ€§èƒ½è°ƒä¼˜](https://www.jianshu.com/p/8786636f99ad)**
**[æœ€å¼ºæ•´ç†ï¼šä¸€çº¿äº’è”ç½‘ç§»åŠ¨æ¶æ„å¸ˆè®¾è®¡æ€æƒ³è§£è¯»å¼€æºæ¡†æ¶](https://www.jianshu.com/p/0263e475b314)**
**[æœ€å¼ºæ•´ç†ï¼šä¸€çº¿äº’è”ç½‘ç§»åŠ¨æ¶æ„å¸ˆNDKæ¨¡å—å¼€å‘](https://www.jianshu.com/p/7f201b2c2857)**
**[æœ€å¼ºæ•´ç†ï¼šFlutterå®Œå…¨è¿›é˜¶æ‰‹å†Œ](https://www.jianshu.com/p/05d5fdc2d99e)**
